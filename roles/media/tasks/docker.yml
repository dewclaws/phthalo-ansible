---
- name: Ensure Docker group exists
  ansible.builtin.group:
    name: docker

- name: Add users to Docker group
  ansible.builtin.user:
    name: "{{ item }}"
    groups: docker
    append: true
  loop:
    - "{{ ansible_user }}"
    - media

- name: Enable Docker service
  ansible.builtin.service:
    name: docker
    enabled: true
    state: started

- name: Create download dir
  ansible.builtin.file:
    path: "{{ media_zfs_pool_mount }}/downloads"
    state: directory
    owner: media
    group: media
    mode: "0770"

- name: Create Docker containers
  ansible.builtin.include_tasks: "{{ item }}"
  loop: "{{ lookup('fileglob', 'docker-containers/*.yml', wantlist=True) }}"
